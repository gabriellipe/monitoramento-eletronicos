<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MVP – Registro de Ocorrência (sem login)</title>
  <style>
    body{font-family: system-ui, Arial, sans-serif; margin:24px; max-width:760px}
    h1{font-size:1.4rem; margin-bottom:8px}
    .card{border:1px solid #ddd; border-radius:12px; padding:16px; margin-bottom:16px}
    label{display:block; margin:8px 0 4px}
    input, select, textarea, button{width:100%; padding:10px; border:1px solid #ccc; border-radius:8px}
    textarea{min-height:90px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .hint{color:#666; font-size:.9rem}
    .ok{background:#e6ffed; border-color:#b7f2c0}
    .err{background:#ffecec; border-color:#ffb3b3}
    .hidden{display:none}
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin:8px 0}
    .chip{border:1px solid #ccc; padding:6px 10px; border-radius:999px; cursor:pointer; user-select:none}
    .chip.active{background:#eef; border-color:#99c}
    .footer{font-size:.85rem; color:#666; margin-top:24px}
  </style>
</head>
<body>
  <h1>MVP – Registro de Ocorrência (sem login)</h1>
  <p class="hint">⚠️ MVP de demonstração. Não usar em produção. Use iniciais/códigos (sem nome completo).</p>

  <div class="card">
    <label>PIN do professor (4 dígitos)</label>
    <input id="pin" placeholder="Ex.: 1234" maxlength="6">
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label>Turma</label>
        <select id="turma">
          <option value="">Selecione...</option>
          <option>6ºA</option><option>6ºB</option>
          <option>7ºA</option><option>7ºB</option>
          <option>8ºA</option><option>8ºB</option>
          <option>9ºA</option><option>9ºB</option>
        </select>
      </div>
      <div>
        <label>Professor(a)</label>
        <input id="professor" placeholder="Ex.: M. Souza">
      </div>
    </div>

    <div class="row">
      <div>
        <label>Aluno (iniciais/código)</label>
        <input id="aluno" placeholder="Ex.: A23">
      </div>
      <div>
        <label>Ocorrência</label>
        <select id="ocorrencia">
          <option value="">Selecione...</option>
          <option value="uso_indevido">Uso indevido em sala</option>
          <option value="reincidencia">Reincidência</option>
          <option value="grave">Grave (desrespeito / conflito)</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>Passo do Protocolo</label>
        <select id="passo">
          <option value="">Selecione...</option>
          <option value="advertencia">Advertência educativa</option>
          <option value="conscientizacao">Atividade de conscientização</option>
          <option value="recolhimento">Recolhimento (sem exposição)</option>
          <option value="registro">Registro e acompanhamento</option>
          <option value="familia">Envolvimento familiar</option>
          <option value="acompanhamento">Acompanhamento reflexivo</option>
        </select>
      </div>
      <div>
        <label>Sinais observados (opcional)</label>
        <div class="chips" id="sinais">
          <div class="chip" data-key="distracao">Distração</div>
          <div class="chip" data-key="ansiedade">Ansiedade/irritação</div>
          <div class="chip" data-key="isolamento">Isolamento social</div>
          <div class="chip" data-key="queda">Queda no rendimento</div>
          <div class="chip" data-key="sonolencia">Sonolência</div>
        </div>
      </div>
    </div>

    <label>Observações (opcional)</label>
    <textarea id="obs" placeholder="Descrição objetiva do fato (máx. 1000 caracteres)"></textarea>

    <button id="enviar">Enviar registro</button>
    <div id="msg" class="card hidden"></div>
  </div>

  <div class="footer">Configure SUPABASE_URL e SUPABASE_ANON_KEY abaixo.</div>

  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://wzzryluesqxwyijievyj.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6enJ5bHVlc3F4d3lpamlldnlqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5OTk2NjYsImV4cCI6MjA3NDU3NTY2Nn0.aqT7PaKjj9QS547HEQ7EDyl8kvCIg4GrQJ4AXvjsG0k";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const PIN_ESPERADO = "1234"; // troque para a sua demo

    const chips = document.querySelectorAll('.chip');
    chips.forEach(c => c.addEventListener('click', () => c.classList.toggle('active')));

    const $ = (id) => document.getElementById(id);
    const msg = $("msg");

    function showMessage(text, ok=true){
      msg.className = "card " + (ok ? "ok" : "err");
      msg.textContent = text;
      msg.classList.remove("hidden");
    }

    function getSinais(){
      return Array.from(document.querySelectorAll('.chip.active')).map(c => c.dataset.key);
    }

    $("enviar").addEventListener("click", async () => {
      const pin = $("pin").value.trim();
      if(pin !== PIN_ESPERADO){ showMessage("PIN inválido.", false); return; }

      const turma = $("turma").value.trim();
      const professor = $("professor").value.trim();
      const aluno = $("aluno").value.trim();
      const ocorrencia = $("ocorrencia").value;
      const passo = $("passo").value;
      const sinais = getSinais();
      const observacoes = $("obs").value.trim();

      if(!turma || !professor || !aluno || !ocorrencia || !passo){
        showMessage("Preencha os campos obrigatórios.", false);
        return;
      }

      const { error } = await supabase.from("ocorrencias").insert([{
        turma, professor, aluno_codigo: aluno,
        ocorrencia, passo_protocolo: passo, sinais, observacoes
      }]);

      if(error){ console.error(error); showMessage("Falha ao enviar.", false); return; }

      $("aluno").value = "";
      $("ocorrencia").value = "";
      $("passo").value = "";
      $("obs").value = "";
      chips.forEach(c => c.classList.remove('active'));
      showMessage("Registro enviado com sucesso!");
    });
  </script>
</body>
</html>

