<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de InfraÃ§Ãµes Disciplinares</title>
    <link rel="stylesheet" href="style-adicional.css">
    <style>
        /* Estilos especÃ­ficos para demonstraÃ§Ã£o das funÃ§Ãµes */
        .demo-section {
            background: var(--color-secondary);
            padding: var(--space-16);
            border-radius: var(--radius-base);
            margin: var(--space-16) 0;
        }
        
        .demo-button {
            margin: var(--space-8);
            padding: var(--space-12) var(--space-16);
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: var(--radius-base);
            cursor: pointer;
        }
        
        .demo-button:hover {
            background: var(--color-primary-hover);
        }

        .resultado {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            padding: var(--space-12);
            margin-top: var(--space-12);
            border-radius: var(--radius-base);
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="screen">
        <div class="login-container">
            <h1>Sistema de InfraÃ§Ãµes Disciplinares</h1>
            <div class="login-card">
                <h2>FaÃ§a login para acessar o sistema</h2>
                
                <!-- FormulÃ¡rio de Login -->
                <form id="loginForm">
                    <div class="input-group">
                        <label for="loginEmail">Email:</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="input-group">
                        <label for="loginPassword">Senha:</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="button" id="loginBtn" class="primary-btn">Entrar</button>
                </form>

                <p class="auth-link">NÃ£o tem conta? <a href="#" id="showSignupLink">Cadastre-se</a></p>

                <!-- SeÃ§Ã£o de DemonstraÃ§Ã£o das FunÃ§Ãµes -->
                <div class="demo-section">
                    <h3>ğŸ§ª Teste das FunÃ§Ãµes do Supabase</h3>
                    <p><small>Use estes botÃµes para testar as funÃ§Ãµes do sistema:</small></p>
                    
                    <button class="demo-button" onclick="testarConexaoSupabase()">
                        ğŸ”— Testar ConexÃ£o
                    </button>
                    
                    <button class="demo-button" onclick="testarLogin()">
                        ğŸ”‘ Testar Login
                    </button>
                    
                    <button class="demo-button" onclick="testarCadastro()">
                        â• Testar Cadastro
                    </button>
                    
                    <div id="resultadoTeste" class="resultado" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Cadastro -->
    <div id="signupScreen" class="screen" style="display: none;">
        <div class="login-container">
            <h1>Criar Conta</h1>
            <div class="login-card">
                <h2>Cadastre-se no sistema</h2>
                
                <form id="signupForm">
                    <div class="input-group">
                        <label for="signupEmail">Email:</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="input-group">
                        <label for="signupPassword">Senha:</label>
                        <input type="password" id="signupPassword" required minlength="6">
                    </div>
                    <div class="input-group">
                        <label for="signupConfirm">Confirmar Senha:</label>
                        <input type="password" id="signupConfirm" required minlength="6">
                    </div>
                    <button type="button" id="signupBtn" class="primary-btn">Criar Conta</button>
                </form>

                <p class="auth-link">JÃ¡ tem conta? <a href="#" id="showLoginLink">Fazer login</a></p>
            </div>
        </div>
    </div>

    <!-- Tela de Setup do Perfil -->
    <div id="setupScreen" class="screen" style="display: none;">
        <div class="setup-container">
            <h1>Configurar Perfil</h1>
            <div class="setup-card">
                <h2>Complete seu perfil</h2>
                
                <form id="setupForm">
                    <div class="input-group">
                        <label for="setupEmail">Email:</label>
                        <input type="email" id="setupEmail" readonly>
                    </div>
                    <div class="input-group">
                        <label for="setupNome">Nome Completo:</label>
                        <input type="text" id="setupNome" required>
                    </div>
                    <div class="input-group">
                        <label for="setupRole">Papel:</label>
                        <select id="setupRole" required>
                            <option value="">Selecionar papel</option>
                            <option value="teacher">Professor</option>
                            <option value="manager">Gestor</option>
                        </select>
                    </div>
                    <button type="button" id="setupProfileBtn" class="primary-btn">Completar Perfil</button>
                </form>
            </div>
        </div>
    </div>

    <!-- AplicaÃ§Ã£o Principal -->
    <div id="appScreen" class="screen" style="display: none;">
        <!-- Header -->
        <header class="header">
            <h1>Sistema de InfraÃ§Ãµes Disciplinares</h1>
            <div class="user-info">
                <span id="userInfo">Carregando...</span>
                <button id="logoutBtn" class="secondary-btn">Sair</button>
            </div>
        </header>

        <!-- NavegaÃ§Ã£o por Abas -->
        <nav class="tabs">
            <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
            <button class="tab-btn" data-tab="registrar">Registrar OcorrÃªncia</button>
            <button class="tab-btn" data-tab="ocorrencias">Minhas OcorrÃªncias</button>
            <button class="tab-btn manager-only" data-tab="gerenciar">Gerenciar Sistema</button>
            <button class="tab-btn manager-only" data-tab="usuarios">UsuÃ¡rios</button>
            <button class="tab-btn manager-only" data-tab="estatisticas">EstatÃ­sticas</button>
        </nav>

        <!-- ConteÃºdo das Abas -->
        <main class="main-content">
            <!-- Aba Dashboard -->
            <div id="dashboardTab" class="tab-content">
                <div class="card">
                    <h2>ğŸ  Dashboard Principal</h2>
                    <p>Bem-vindo ao sistema de gestÃ£o de infraÃ§Ãµes disciplinares!</p>
                    
                    <!-- DemonstraÃ§Ã£o das FunÃ§Ãµes Supabase -->
                    <div class="demo-section">
                        <h3>ğŸ› ï¸ DemonstraÃ§Ã£o das FunÃ§Ãµes</h3>
                        <p>Clique nos botÃµes abaixo para testar as funÃ§Ãµes do Supabase:</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <button class="demo-button" onclick="demonstrarBuscarPerfis()">
                                ğŸ‘¥ Buscar Perfis
                            </button>
                            <button class="demo-button" onclick="demonstrarBuscarTurmas()">
                                ğŸ“š Buscar Turmas
                            </button>
                            <button class="demo-button" onclick="demonstrarBuscarOcorrencias()">
                                ğŸ“‹ Buscar OcorrÃªncias
                            </button>
                            <button class="demo-button" onclick="demonstrarEstatisticas()">
                                ğŸ“Š Ver EstatÃ­sticas
                            </button>
                        </div>
                        
                        <div id="resultadoDemonstracao" class="resultado" style="display:none;"></div>
                    </div>
                </div>
            </div>

            <!-- Aba Registrar OcorrÃªncia -->
            <div id="registrarTab" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>ğŸ“ Registrar Nova OcorrÃªncia</h2>
                    
                    <form id="ocorrenciaForm">
                        <div class="row">
                            <div class="input-group">
                                <label for="turmaSelect">Turma:</label>
                                <select id="turmaSelect" required>
                                    <option value="">Carregando turmas...</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="alunoNome">Nome do Aluno:</label>
                                <input type="text" id="alunoNome" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="input-group">
                                <label for="tipoOcorrencia">Tipo de OcorrÃªncia:</label>
                                <select id="tipoOcorrencia" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="Uso de celular durante a aula">ğŸ“± Uso de celular</option>
                                    <option value="Conversa excessiva">ğŸ’¬ Conversa excessiva</option>
                                    <option value="NÃ£o fez a atividade">ğŸ“ NÃ£o fez atividade</option>
                                    <option value="Comportamento inadequado">ğŸ˜¤ Comportamento inadequado</option>
                                    <option value="Atraso">â° Atraso</option>
                                    <option value="Desrespeito">ğŸš« Desrespeito</option>
                                    <option value="Outros">â“ Outros</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="gravidadeSelect">Gravidade:</label>
                                <select id="gravidadeSelect" required>
                                    <option value="leve">ğŸŸ¢ Leve</option>
                                    <option value="media" selected>ğŸŸ¡ MÃ©dia</option>
                                    <option value="grave">ğŸ”´ Grave</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="input-group">
                            <label for="descricaoOcorrencia">DescriÃ§Ã£o Detalhada:</label>
                            <textarea id="descricaoOcorrencia" rows="4" required 
                                     placeholder="Descreva o que aconteceu de forma detalhada..."></textarea>
                        </div>
                        
                        <button type="submit" class="primary-btn">ğŸ“‹ Registrar OcorrÃªncia</button>
                    </form>
                </div>
            </div>

            <!-- Aba OcorrÃªncias -->
            <div id="ocorrenciasTab" class="tab-content" style="display: none;">
                <div class="card">
                    <h2>ğŸ“‹ Minhas OcorrÃªncias</h2>
                    
                    <!-- Filtros -->
                    <div class="filters">
                        <select id="filtroStatus">
                            <option value="">Todos os Status</option>
                            <option value="pendente">â³ Pendentes</option>
                            <option value="resolvida">âœ… Resolvidas</option>
                        </select>
                        <select id="filtroTurma">
                            <option value="">Todas as Turmas</option>
                        </select>
                        <button onclick="carregarOcorrenciasComFiltros()" class="secondary-btn">ğŸ” Filtrar</button>
                        <button onclick="carregarMinhasOcorrencias()" class="primary-btn">ğŸ”„ Atualizar</button>
                    </div>
                    
                    <div id="listaOcorrencias">
                        <p>Carregando ocorrÃªncias...</p>
                    </div>
                </div>
            </div>

            <!-- Aba Gerenciar (apenas gestores) -->
            <div id="gerenciarTab" class="tab-content manager-only" style="display: none;">
                <div class="card">
                    <h2>âš™ï¸ Gerenciar Sistema</h2>
                    
                    <!-- GestÃ£o de Turmas -->
                    <h3>ğŸ“š Vincular Turmas</h3>
                    <form id="turmaForm" style="margin-bottom: 24px;">
                        <div class="row">
                            <div class="input-group">
                                <label for="professorEmail">Email do Professor:</label>
                                <input type="email" id="professorEmail" required>
                            </div>
                            <div class="input-group">
                                <label for="nomeTurma">Nome da Turma:</label>
                                <input type="text" id="nomeTurma" required placeholder="Ex: 7Â°A, 8Â°B, 1Â°EM-A">
                            </div>
                        </div>
                        <button type="submit" class="primary-btn">ğŸ”— Vincular Turma</button>
                    </form>
                    
                    <!-- ResoluÃ§Ã£o de OcorrÃªncias -->
                    <h3>âš–ï¸ Resolver OcorrÃªncias Pendentes</h3>
                    <button onclick="carregarOcorrenciasPendentes()" class="secondary-btn">ğŸ“‹ Ver Pendentes</button>
                    <div id="ocorrenciasPendentes" style="margin-top: 16px;"></div>
                </div>
            </div>

            <!-- Aba UsuÃ¡rios (apenas gestores) -->
            <div id="usuariosTab" class="tab-content manager-only" style="display: none;">
                <div class="card">
                    <h2>ğŸ‘¥ Gerenciar UsuÃ¡rios</h2>
                    
                    <!-- Criar Novo UsuÃ¡rio -->
                    <h3>â• Criar Novo UsuÃ¡rio</h3>
                    <form id="novoUsuarioForm" style="margin-bottom: 24px;">
                        <div class="row">
                            <div class="input-group">
                                <label for="novoEmail">Email:</label>
                                <input type="email" id="novoEmail" required>
                            </div>
                            <div class="input-group">
                                <label for="novaSenha">Senha TemporÃ¡ria:</label>
                                <input type="password" id="novaSenha" required minlength="6">
                            </div>
                        </div>
                        <div class="row">
                            <div class="input-group">
                                <label for="novoNome">Nome Completo:</label>
                                <input type="text" id="novoNome" required>
                            </div>
                            <div class="input-group">
                                <label for="novoPapel">Papel:</label>
                                <select id="novoPapel" required>
                                    <option value="">Selecionar</option>
                                    <option value="teacher">ğŸ‘¨â€ğŸ« Professor</option>
                                    <option value="manager">ğŸ‘” Gestor</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="primary-btn">ğŸ‘¤ Criar UsuÃ¡rio</button>
                    </form>
                    
                    <!-- Lista de UsuÃ¡rios -->
                    <h3>ğŸ“‹ UsuÃ¡rios Cadastrados</h3>
                    <button onclick="carregarListaUsuarios()" class="secondary-btn">ğŸ”„ Atualizar Lista</button>
                    <div id="listaUsuarios" style="margin-top: 16px;">
                        <p>Clique em "Atualizar Lista" para ver os usuÃ¡rios.</p>
                    </div>
                </div>
            </div>

            <!-- Aba EstatÃ­sticas (apenas gestores) -->
            <div id="estatisticasTab" class="tab-content manager-only" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="statHoje">0</h3>
                        <p>OcorrÃªncias Hoje</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="statPendentes">0</h3>
                        <p>Pendentes</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="statResolvidas">0</h3>
                        <p>Resolvidas</p>
                    </div>
                    <div class="stat-card">
                        <h3 id="statUsuarios">0</h3>
                        <p>UsuÃ¡rios</p>
                    </div>
                </div>
                
                <div class="card">
                    <h2>ğŸ“Š RelatÃ³rio Detalhado</h2>
                    <div class="row">
                        <div class="input-group">
                            <label for="dataInicio">Data InÃ­cio:</label>
                            <input type="date" id="dataInicio">
                        </div>
                        <div class="input-group">
                            <label for="dataFim">Data Fim:</label>
                            <input type="date" id="dataFim">
                        </div>
                    </div>
                    <button onclick="gerarRelatorio()" class="primary-btn">ğŸ“ˆ Gerar RelatÃ³rio</button>
                    <div id="relatorioResultado" style="margin-top: 16px;"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="02-supabase-funcoes-completas.js"></script>
    
    <!-- Script de Interface e DemonstraÃ§Ãµes -->
    <script>
        // ===================================================================
        // FUNÃ‡Ã•ES DE INTERFACE E DEMONSTRAÃ‡ÃƒO
        // ===================================================================

        // NavegaÃ§Ã£o entre telas
        document.getElementById('showSignupLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            mostrarTela('signupScreen');
        });

        document.getElementById('showLoginLink')?.addEventListener('click', (e) => {
            e.preventDefault();
            mostrarTela('loginScreen');
        });

        // BotÃµes principais
        document.getElementById('loginBtn')?.addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (await SupabaseFuncoes.fazerLogin(email, password)) {
                mostrarTela('appScreen');
                carregarDadosIniciais();
            }
        });

        document.getElementById('signupBtn')?.addEventListener('click', async () => {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirm = document.getElementById('signupConfirm').value;
            
            if (password !== confirm) {
                alert('Senhas nÃ£o coincidem!');
                return;
            }
            
            if (await SupabaseFuncoes.cadastrarUsuario(email, password)) {
                mostrarTela('loginScreen');
            }
        });

        document.getElementById('setupProfileBtn')?.addEventListener('click', async () => {
            const email = document.getElementById('setupEmail').value;
            const nome = document.getElementById('setupNome').value;
            const papel = document.getElementById('setupRole').value;
            
            if (await SupabaseFuncoes.criarPerfil(email, papel, nome)) {
                mostrarTela('appScreen');
                carregarDadosIniciais();
            }
        });

        document.getElementById('logoutBtn')?.addEventListener('click', () => {
            SupabaseFuncoes.fazerLogout();
        });

        // NavegaÃ§Ã£o por abas
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const tabName = e.target.dataset.tab;
                mostrarAba(tabName);
            });
        });

        // FormulÃ¡rios
        document.getElementById('ocorrenciaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const dados = {
                turma: document.getElementById('turmaSelect').value,
                aluno_nome: document.getElementById('alunoNome').value,
                tipo_ocorrencia: document.getElementById('tipoOcorrencia').value,
                descricao: document.getElementById('descricaoOcorrencia').value,
                gravidade: document.getElementById('gravidadeSelect').value
            };
            
            if (await SupabaseFuncoes.registrarOcorrencia(dados)) {
                document.getElementById('ocorrenciaForm').reset();
                carregarMinhasOcorrencias();
            }
        });

        document.getElementById('turmaForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const professorEmail = document.getElementById('professorEmail').value;
            const turma = document.getElementById('nomeTurma').value;
            
            if (await SupabaseFuncoes.vincularTurmaProfessor(professorEmail, turma)) {
                document.getElementById('turmaForm').reset();
            }
        });

        document.getElementById('novoUsuarioForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('novoEmail').value;
            const senha = document.getElementById('novaSenha').value;
            const nome = document.getElementById('novoNome').value;
            const papel = document.getElementById('novoPapel').value;
            
            if (await SupabaseFuncoes.criarUsuarioComPerfil(email, senha, papel, nome)) {
                document.getElementById('novoUsuarioForm').reset();
                carregarListaUsuarios();
            }
        });

        // FunÃ§Ãµes auxiliares de interface
        function mostrarTela(telaId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.style.display = 'none';
            });
            document.getElementById(telaId).style.display = 'block';
        }

        function mostrarAba(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // ===================================================================
        // FUNÃ‡Ã•ES DE DEMONSTRAÃ‡ÃƒO DAS FUNCIONALIDADES SUPABASE
        // ===================================================================

        async function testarConexaoSupabase() {
            const resultado = document.getElementById('resultadoTeste');
            resultado.style.display = 'block';
            resultado.innerHTML = '<p>ğŸ”„ Testando conexÃ£o com Supabase...</p>';
            
            try {
                // Tentar fazer uma consulta simples
                const { data, error } = await supabase.from('perfis').select('count').limit(1);
                
                if (error) {
                    resultado.innerHTML = `<p>âŒ Erro na conexÃ£o: ${error.message}</p>`;
                } else {
                    resultado.innerHTML = `
                        <p>âœ… ConexÃ£o com Supabase estabelecida!</p>
                        <p>ğŸ“Š URL: ${SUPABASE_URL}</p>
                        <p>ğŸ”‘ Chave: ${SUPABASE_ANON_KEY.substring(0, 20)}...</p>
                    `;
                }
            } catch (err) {
                resultado.innerHTML = `<p>âŒ Erro inesperado: ${err.message}</p>`;
            }
        }

        async function testarLogin() {
            const email = document.getElementById('loginEmail').value || 'teste@exemplo.com';
            const password = document.getElementById('loginPassword').value || '123456';
            
            const resultado = document.getElementById('resultadoTeste');
            resultado.style.display = 'block';
            resultado.innerHTML = `<p>ğŸ”„ Testando login com: ${email}</p>`;
            
            const sucesso = await SupabaseFuncoes.fazerLogin(email, password);
            
            if (sucesso) {
                resultado.innerHTML += `<p>âœ… Login realizado com sucesso!</p>`;
            } else {
                resultado.innerHTML += `<p>âŒ Falha no login. Verifique as credenciais.</p>`;
            }
        }

        async function testarCadastro() {
            const email = `teste${Date.now()}@exemplo.com`;
            const password = 'senha123';
            
            const resultado = document.getElementById('resultadoTeste');
            resultado.style.display = 'block';
            resultado.innerHTML = `<p>ğŸ”„ Testando cadastro com: ${email}</p>`;
            
            const sucesso = await SupabaseFuncoes.cadastrarUsuario(email, password);
            
            if (sucesso) {
                resultado.innerHTML += `<p>âœ… Cadastro realizado com sucesso!</p>`;
            } else {
                resultado.innerHTML += `<p>âŒ Falha no cadastro.</p>`;
            }
        }

        async function demonstrarBuscarPerfis() {
            const resultado = document.getElementById('resultadoDemonstracao');
            resultado.style.display = 'block';
            resultado.innerHTML = '<p>ğŸ”„ Buscando perfis...</p>';
            
            const perfis = await SupabaseFuncoes.buscarTodosPerfis();
            
            if (perfis.length > 0) {
                const lista = perfis.map(p => 
                    `<li>ğŸ‘¤ ${p.nome || p.email} - ${p.papel === 'manager' ? 'ğŸ‘” Gestor' : 'ğŸ‘¨â€ğŸ« Professor'}</li>`
                ).join('');
                
                resultado.innerHTML = `
                    <h4>âœ… Perfis Encontrados (${perfis.length}):</h4>
                    <ul>${lista}</ul>
                `;
            } else {
                resultado.innerHTML = '<p>ğŸ“­ Nenhum perfil encontrado.</p>';
            }
        }

        async function demonstrarBuscarTurmas() {
            const resultado = document.getElementById('resultadoDemonstracao');
            resultado.style.display = 'block';
            resultado.innerHTML = '<p>ğŸ”„ Buscando turmas...</p>';
            
            const turmas = await SupabaseFuncoes.buscarTodasTurmas();
            
            if (turmas.length > 0) {
                const lista = turmas.map(t => 
                    `<li>ğŸ“š ${t.turma} - Professor: ${t.perfis.nome || t.perfis.email}</li>`
                ).join('');
                
                resultado.innerHTML = `
                    <h4>âœ… Turmas Encontradas (${turmas.length}):</h4>
                    <ul>${lista}</ul>
                `;
            } else {
                resultado.innerHTML = '<p>ğŸ“­ Nenhuma turma encontrada.</p>';
            }
        }

        async function demonstrarBuscarOcorrencias() {
            const resultado = document.getElementById('resultadoDemonstracao');
            resultado.style.display = 'block';
            resultado.innerHTML = '<p>ğŸ”„ Buscando ocorrÃªncias...</p>';
            
            const ocorrencias = await SupabaseFuncoes.buscarOcorrencias();
            
            if (ocorrencias.length > 0) {
                const lista = ocorrencias.map(o => 
                    `<li>ğŸ“‹ ${o.tipo_ocorrencia} - ${o.aluno_nome} (${o.turma}) - ${o.status}</li>`
                ).join('');
                
                resultado.innerHTML = `
                    <h4>âœ… OcorrÃªncias Encontradas (${ocorrencias.length}):</h4>
                    <ul>${lista}</ul>
                `;
            } else {
                resultado.innerHTML = '<p>ğŸ“­ Nenhuma ocorrÃªncia encontrada.</p>';
            }
        }

        async function demonstrarEstatisticas() {
            const resultado = document.getElementById('resultadoDemonstracao');
            resultado.style.display = 'block';
            resultado.innerHTML = '<p>ğŸ”„ Carregando estatÃ­sticas...</p>';
            
            const stats = await SupabaseFuncoes.buscarEstatisticas();
            
            resultado.innerHTML = `
                <h4>ğŸ“Š EstatÃ­sticas do Sistema:</h4>
                <ul>
                    <li>ğŸ“… OcorrÃªncias hoje: ${stats.ocorrenciasHoje}</li>
                    <li>â³ Pendentes: ${stats.ocorrenciasPendentes}</li>
                    <li>âœ… Resolvidas: ${stats.ocorrenciasResolvidas}</li>
                    <li>ğŸ‘¥ Total de usuÃ¡rios: ${stats.totalUsuarios}</li>
                </ul>
            `;
        }

        // Carregar dados iniciais ao entrar na aplicaÃ§Ã£o
        async function carregarDadosIniciais() {
            // Atualizar informaÃ§Ãµes do usuÃ¡rio
            const userInfo = document.getElementById('userInfo');
            userInfo.textContent = `${SupabaseFuncoes.getUserEmail()} (${SupabaseFuncoes.getUserRole() === 'manager' ? 'Gestor' : 'Professor'})`;
            
            // Mostrar/ocultar elementos baseado no papel
            const managerElements = document.querySelectorAll('.manager-only');
            const isManager = SupabaseFuncoes.getUserRole() === 'manager';
            
            managerElements.forEach(el => {
                el.style.display = isManager ? 'block' : 'none';
            });
            
            // Carregar turmas do usuÃ¡rio
            await carregarTurmasUsuario();
            
            // Se for gestor, carregar estatÃ­sticas
            if (isManager) {
                await atualizarEstatisticas();
            }
        }

        async function carregarTurmasUsuario() {
            const turmas = await SupabaseFuncoes.buscarMinhasTurmas();
            
            const selects = ['turmaSelect', 'filtroTurma'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = selectId === 'filtroTurma' ? 
                        '<option value="">Todas as Turmas</option>' :
                        '<option value="">Selecione uma turma</option>';
                    
                    turmas.forEach(turma => {
                        const option = document.createElement('option');
                        option.value = turma.turma;
                        option.textContent = turma.turma;
                        select.appendChild(option);
                    });
                }
            });
        }

        async function carregarMinhasOcorrencias() {
            const ocorrencias = await SupabaseFuncoes.buscarOcorrencias();
            const container = document.getElementById('listaOcorrencias');
            
            if (ocorrencias.length === 0) {
                container.innerHTML = '<p class="no-data">ğŸ“­ Nenhuma ocorrÃªncia encontrada.</p>';
                return;
            }
            
            container.innerHTML = ocorrencias.map(occ => `
                <div class="occurrence-card status-${occ.status}">
                    <div class="occurrence-header">
                        <span class="date">${new Date(occ.data_ocorrencia).toLocaleString('pt-BR')}</span>
                        <span class="status ${occ.status}">${occ.status}</span>
                    </div>
                    <div class="occurrence-body">
                        <h4>${occ.tipo_ocorrencia}</h4>
                        <p><strong>Aluno:</strong> ${occ.aluno_nome}</p>
                        <p><strong>Turma:</strong> ${occ.turma}</p>
                        <p><strong>Gravidade:</strong> ${occ.gravidade}</p>
                        <p><strong>DescriÃ§Ã£o:</strong> ${occ.descricao}</p>
                        ${occ.penalidade ? `<p><strong>Penalidade:</strong> ${occ.penalidade}</p>` : ''}
                        ${occ.observacoes_gestor ? `<p><strong>ObservaÃ§Ãµes:</strong> ${occ.observacoes_gestor}</p>` : ''}
                    </div>
                </div>
            `).join('');
        }

        async function carregarOcorrenciasComFiltros() {
            const filtros = {
                status: document.getElementById('filtroStatus').value,
                turma: document.getElementById('filtroTurma').value
            };
            
            const ocorrencias = await SupabaseFuncoes.buscarOcorrencias(filtros);
            // Usar a mesma funÃ§Ã£o de renderizaÃ§Ã£o
            const container = document.getElementById('listaOcorrencias');
            // ... cÃ³digo similar ao carregarMinhasOcorrencias
        }

        async function carregarListaUsuarios() {
            const usuarios = await SupabaseFuncoes.buscarTodosPerfis();
            const container = document.getElementById('listaUsuarios');
            
            if (usuarios.length === 0) {
                container.innerHTML = '<p>ğŸ“­ Nenhum usuÃ¡rio encontrado.</p>';
                return;
            }
            
            container.innerHTML = `
                <div style="display: grid; gap: 12px;">
                    ${usuarios.map(user => `
                        <div class="perfil-card">
                            <h4>${user.nome || user.email}</h4>
                            <p><strong>Email:</strong> ${user.email}</p>
                            <p><strong>Papel:</strong> ${user.papel === 'manager' ? 'ğŸ‘” Gestor' : 'ğŸ‘¨â€ğŸ« Professor'}</p>
                            <p><strong>Criado em:</strong> ${new Date(user.created_at).toLocaleDateString('pt-BR')}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function atualizarEstatisticas() {
            const stats = await SupabaseFuncoes.buscarEstatisticas();
            
            document.getElementById('statHoje').textContent = stats.ocorrenciasHoje || 0;
            document.getElementById('statPendentes').textContent = stats.ocorrenciasPendentes || 0;
            document.getElementById('statResolvidas').textContent = stats.ocorrenciasResolvidas || 0;
            document.getElementById('statUsuarios').textContent = stats.totalUsuarios || 0;
        }

        async function carregarOcorrenciasPendentes() {
            const ocorrencias = await SupabaseFuncoes.buscarOcorrencias({ status: 'pendente' });
            const container = document.getElementById('ocorrenciasPendentes');
            
            if (ocorrencias.length === 0) {
                container.innerHTML = '<p>âœ… Nenhuma ocorrÃªncia pendente!</p>';
                return;
            }
            
            container.innerHTML = ocorrencias.map(occ => `
                <div class="occurrence-card status-pendente" style="margin-bottom: 12px;">
                    <div class="occurrence-body">
                        <h4>${occ.tipo_ocorrencia}</h4>
                        <p><strong>Aluno:</strong> ${occ.aluno_nome} | <strong>Turma:</strong> ${occ.turma}</p>
                        <p><strong>Professor:</strong> ${occ.professor_email}</p>
                        <p><strong>DescriÃ§Ã£o:</strong> ${occ.descricao}</p>
                        <button onclick="resolverOcorrenciaModal(${occ.id})" class="resolve-btn">âš–ï¸ Resolver</button>
                    </div>
                </div>
            `).join('');
        }

        async function resolverOcorrenciaModal(ocorrenciaId) {
            const penalidade = prompt('Digite a penalidade aplicada:');
            if (!penalidade) return;
            
            const observacoes = prompt('ObservaÃ§Ãµes do gestor (opcional):');
            
            if (await SupabaseFuncoes.resolverOcorrencia(ocorrenciaId, penalidade, observacoes)) {
                carregarOcorrenciasPendentes();
                atualizarEstatisticas();
            }
        }

        async function gerarRelatorio() {
            const dataInicio = document.getElementById('dataInicio').value;
            const dataFim = document.getElementById('dataFim').value;
            
            if (!dataInicio || !dataFim) {
                alert('Por favor, selecione as datas para o relatÃ³rio');
                return;
            }
            
            const filtros = {
                data_inicio: dataInicio,
                data_fim: dataFim + 'T23:59:59'
            };
            
            const ocorrencias = await SupabaseFuncoes.buscarOcorrencias(filtros);
            const container = document.getElementById('relatorioResultado');
            
            const totalOcorrencias = ocorrencias.length;
            const pendentes = ocorrencias.filter(o => o.status === 'pendente').length;
            const resolvidas = ocorrencias.filter(o => o.status === 'resolvida').length;
            
            const tiposCount = {};
            ocorrencias.forEach(o => {
                tiposCount[o.tipo_ocorrencia] = (tiposCount[o.tipo_ocorrencia] || 0) + 1;
            });
            
            container.innerHTML = `
                <div class="report-summary">
                    <h3>ğŸ“Š RelatÃ³rio: ${new Date(dataInicio).toLocaleDateString('pt-BR')} a ${new Date(dataFim).toLocaleDateString('pt-BR')}</h3>
                    <p><strong>Total de ocorrÃªncias:</strong> ${totalOcorrencias}</p>
                    <p><strong>Pendentes:</strong> ${pendentes} | <strong>Resolvidas:</strong> ${resolvidas}</p>
                    
                    <h4>ğŸ“‹ Tipos mais comuns:</h4>
                    <ul>
                        ${Object.entries(tiposCount)
                            .sort(([,a], [,b]) => b - a)
                            .map(([tipo, count]) => `<li>${tipo}: ${count}</li>`)
                            .join('')}
                    </ul>
                </div>
            `;
        }
    </script>
</body>
</html>